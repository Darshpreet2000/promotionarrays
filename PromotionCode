
 List<promotions> ON_PURCHASE_VALUE = new ArrayList<>();
    List<promotions> ON_PURCHASE_ITEM = new ArrayList<>();
    List<promotions> PURCHASE_VALUE_PROMOTIONS = new ArrayList<>();
    List<promotions> PURCHASE_ITEM_PROMOTIONS = new ArrayList<>();

   
   
    private void promote() {
        for (int i = 0; i < promotionsList.size(); i++) {
            promotions promote = promotionsList.get(i);
            if (promote.getTarget().equals("ALL")) {
                if (promote.getCondition().equals("ON_PURCHASE_VALUE")) {
                    ON_PURCHASE_VALUE.add(promote);
                    apply_promotion_service();
                } else if (promote.getCondition().equals("ON_PURCHASE_ITEM")) {
                    ON_PURCHASE_ITEM.add(promote);
                    apply_promotion_service2();
                }
            }
        }
        List<promotions> concatenated = new ArrayList<promotions>(ON_PURCHASE_VALUE);
        concatenated.addAll(ON_PURCHASE_ITEM);
        Collections.sort(concatenated, new Comparator<promotions>() {
            @Override
            public int compare(promotions o1, promotions o2) {
                if (o1.getPriority() > o2.getPriority())
                    return 1;
                else
                    return 0;
            }
        });

        List<OrderLineItemRestBean> Cart = null;
        //I will pass the original cart model here
        for (int i = 0; i < concatenated.size(); i++) {
            promotions current = concatenated.get(i);
            if (current.getCondition().equals("ON_PURCHASE_VALUE")) {
                if (i == 0) {
                    Cart = resetCart(Cart);
                    Cart = removeAllPromotion(Cart);
                    int cartTotal=getcartTotal(Cart,current);
                    if (recheckCartTotal(Cart, current)) {
                        //  if received true proceed to c
                        switch (current.getRewardType()) {
                            case "ON_VALUE":
                                for (int j = 0; j < Cart.size(); j++) {
                                    OrderLineItemRestBean el = Cart.get(j);
                                    BigDecimal AmountSaved = BigDecimal.valueOf(current.isDiscountInPercentage() ? (el.getOriginalPrice().precision() * current.getDiscountAmount() / 100) : ((el.getOriginalPrice().intValue() * ((((((el.getOriginalPrice().intValue() / cartTotal) * current.getDiscountAmount())) * 100) / el.getOriginalPrice().intValue()))) / 100));
                                    el.setDiscount(AmountSaved);
                                    LineItemPromotionBean p = null;
                                    p.setPromotionId(current.getPromotionid());
                                    p.setAmountSaved((BigDecimal.valueOf(el.getQuantity()).multiply(AmountSaved)));
                                    p.setName(current.getPromotion());
                                    p.setCoupon(current.getTarget() == "COUPON" ? true : false);
                                    el.getItemPromotions().add(p);
                                    el.setDiscount(el.getDiscount().add( current.isDiscountInPercentage() ? BigDecimal.valueOf(current.getDiscountAmount()) : BigDecimal.valueOf(((((el.getOriginalPrice().intValue() / cartTotal) * current.getDiscountAmount()) * 100) / el.getOriginalPrice().intValue()))));
                                }
                                break;
                            case "ON_ITEM":
                                for (int j = 0; j < Cart.size(); j++) {
                                    OrderLineItemRestBean el = Cart.get(j);
                                    if (current.isFreeitem()) {
                                        if (checkForIncludes(current, el) && searchForIteminCart(Cart, el.getProductSku(), current) < current.getItemPromotionQuantity()) {
                                            if (el.getQuantity() <= current.getItemPromotionQuantity()) {
                                                LineItemPromotionBean p = null;
                                                BigDecimal AmountSaved = current.isDiscountInPercentage() ? BigDecimal.valueOf(el.getOriginalPrice().precision() * current.getDiscountAmount() / 100) : BigDecimal.valueOf((el.getOriginalPrice().intValue() * ((((((el.getOriginalPrice().intValue() / cartTotal) * current.getDiscountAmount().intValue())) * 100) / el.getOriginalPrice().intValue()))) / 100);
                                                p.setPromotionId(current.getPromotionid());
                                                p.setAmountSaved((BigDecimal.valueOf(el.getQuantity()).multiply(AmountSaved)));
                                                p.setName(current.getPromotion());
                                                el.getItemPromotions().add(p);
                                                el.setDiscount(BigDecimal.valueOf(100));
                                            }
                                        } else {
                                            OrderLineItemRestBean newObj = el;
                                            el.setQuantity(current.getItemPromotionQuantity());
                                            LineItemPromotionBean p = null;
                                            p.setPromotionId(current.getPromotionid());
                                            p.setAmountSaved(BigDecimal.valueOf(el.getOriginalPrice().intValue() * Math.min(el.getQuantity(), current.getItemPromotionQuantity())));
                                            p.setName(current.getPromotion());
                                            el.getItemPromotions().add(p);
                                            el.setDiscount(BigDecimal.valueOf(100));
                                            newObj.setQuantity(newObj.getQuantity() - current.getItemPromotionQuantity());
                                            Cart.add(newObj);
                                        }
                                    } else {
                                        if (checkForIncludes(current, el) && searchForIteminCart(Cart, el.getProductSku(), current) < current.getItemPromotionQuantity()) {
                                            int amountSaved = current.isDiscountInPercentage() ? (el.getOriginalPrice().intValue() * current.getDiscountAmount().intValue() / 100) : current.getDiscountAmount().intValue();
                                            if (el.getQuantity() <= current.getItemPromotionQuantity()) {
                                                LineItemPromotionBean itemtopush = null;
                                                itemtopush.setName(current.getPromotion());
                                                itemtopush.setPromotionId(current.getPromotionid());
                                                itemtopush.setAmountSaved((BigDecimal.valueOf(el.getQuantity()).multiply(BigDecimal.valueOf(amountSaved))));
                                                itemtopush.setCoupon(current.getTarget().equals("COUPON"));
                                                el.getItemPromotions().add(itemtopush);
                                                el.setDiscount(BigDecimal.valueOf(Math.min(el.getDiscount().longValue() + (current.isDiscountInPercentage() ? (current.getDiscountAmount()) : (current.getDiscountAmount() * 100) / el.getOriginalPrice().intValue()), 100)));
                                            } else {
                                                OrderLineItemRestBean newObj = el;
                                                el.setQuantity(current.getItemPromotionQuantity());
                                                LineItemPromotionBean itemtopush = null;
                                                itemtopush.setName(current.getPromotion());
                                                itemtopush.setPromotionId(current.getPromotionid());
                                                itemtopush.setAmountSaved((BigDecimal.valueOf(el.getQuantity()).multiply(BigDecimal.valueOf(amountSaved))));
                                                itemtopush.setCoupon(current.getTarget().equals("COUPON"));
                                                el.getItemPromotions().add(itemtopush);
                                                el.setDiscount(BigDecimal.valueOf(Math.min(el.getDiscount().longValue() + (current.isDiscountInPercentage() ? (current.getDiscountAmount()) : (current.getDiscountAmount() * 100) / el.getOriginalPrice().intValue()), 100)));
                                                newObj.setQuantity(newObj.getQuantity() - current.getItemPromotionQuantity());
                                                Cart.add(newObj);
                                            }
                                        }
                                    }
                                }
                                break;
                            case "FIXED_PRICE":
                                for (int j = 0; j < Cart.size(); j++) {
                                    OrderLineItemRestBean el = Cart.get(j);
                                    if (checkForIncludes(current, el) && searchForIteminCart(Cart, el.getProductSku(), current) < current.getItemPromotionQuantity()) {
                                        if (el.getQuantity() <= current.getItemPromotionQuantity()) {
                                            BigDecimal amountSaved = BigDecimal.valueOf(((el.getOriginalPrice().subtract(BigDecimal.valueOf(current.getDiscountAmount()))).divide(el.getOriginalPrice())).intValue() * 100);
                                            if (el.getQuantity() <= current.getItemPromotionQuantity()) {
                                                LineItemPromotionBean p = null;
                                                p.setPromotionId(current.getPromotionid());
                                                p.setAmountSaved((BigDecimal.valueOf(el.getQuantity()).multiply(amountSaved)));
                                                p.setName(current.getPromotion());
                                                p.setCoupon(current.getTarget().equals("COUPON"));
                                                el.getItemPromotions().add(p);

                                                el.setDiscount(BigDecimal.valueOf(Math.min(el.getDiscount().longValue() + (((el.getOriginalPrice().subtract(BigDecimal.valueOf(current.getDiscountAmount()))).divide(el.getOriginalPrice()).intValue() * 100)), 100)));
                                            } else {
                                                OrderLineItemRestBean newObj = el;
                                                el.setQuantity(current.getItemPromotionQuantity());
                                                LineItemPromotionBean p = null;
                                                p.setPromotionId(current.getPromotionid());

                                                p.setAmountSaved(amountSaved.multiply(BigDecimal.valueOf(Math.min(current.getItemPromotionQuantity(), el.getQuantity()))));
                                                p.setName(current.getPromotion());
                                                p.setCoupon(current.getTarget().equals("COUPON"));
                                                el.getItemPromotions().add(p);
                                                el.setDiscount(new BigDecimal(Math.min(el.getDiscount().add((el.getOriginalPrice().subtract(BigDecimal.valueOf(current.getDiscountAmount()))).divide(el.getOriginalPrice()).multiply(new BigDecimal(100)), new MathContext(4)).intValue(), 100)));
                                                newObj.setQuantity(newObj.getQuantity() - current.getItemPromotionQuantity());

                                                Cart.add(newObj);
                                            }
                                        }

                                        break;
                                    }
                                }
                        }

                    }
                }
            } else if (current.getCondition().equals("ON_PURCHASE_ITEM")) {
                if (i == 0) {
                    Cart = resetCart(Cart);
                    Cart = removeAllPromotion(Cart);
                }

                switch (current.getRewardType()) {
                    case "ON_VALUE":
                        int asr = current.getAmountSavingReward();
                        for (int j = 0; j < Cart.size(); j++) {
                            OrderLineItemRestBean el = Cart.get(j);
                            if (checkForIncludes(current, el) && cumulativeCheck(el.getProductSku(), current, Cart)) {
                                int amountSaved = current.isDiscountInPercentage() ? ((el.getOriginalPrice().intValue() * current.getDiscountAmount().intValue()) / 100) : Math.min(current.getDiscountAmount().intValue(), el.getOriginalPrice().intValue());
                                if (!current.getFixed().isEmpty()) {
                                    String fixedQty = current.getFixed();
                                    int originalQty = el.getQuantity();
                                    OrderLineItemRestBean newObj = el;

                                    if (originalQty >= Integer.parseInt(fixedQty)) {
                                        LineItemPromotionBean p = null;
                                        p.setPromotionId(current.getPromotionid());
                                        p.setAmountSaved(BigDecimal.valueOf(amountSaved * Math.min(el.getQuantity(), Integer.parseInt(fixedQty))));
                                        p.setName(current.getPromotion());
                                        p.setCoupon(current.getTarget().equals("COUPON"));
                                        el.getItemPromotions().add(p);
                                        el.setQuantity(Math.min(originalQty, Integer.parseInt(fixedQty)));
                                        el.setDiscount(BigDecimal.valueOf(Math.min(el.getDiscount().longValue() + (current.isDiscountInPercentage() ? current.getDiscountAmount() : ((100 * amountSaved) / el.getOriginalPrice().intValue())), 100)));
                                    }

                                    if (originalQty > Integer.parseInt(fixedQty)) {
                                        int tempCount = 0;
                                        for (int k = Integer.parseInt(fixedQty); k < originalQty; k = k + Integer.parseInt(fixedQty)) {
                                            int remainingQtySoFar = originalQty - i;
                                            OrderLineItemRestBean tempObj = newObj;
                                            tempObj.setQuantity(Math.min(remainingQtySoFar, Integer.parseInt(fixedQty)));
                                            if (remainingQtySoFar >= Integer.parseInt(fixedQty)) {

                                                LineItemPromotionBean p = null;
                                                p.setPromotionId(current.getPromotionid());
                                                p.setAmountSaved(BigDecimal.valueOf(Math.round(amountSaved * Math.min(remainingQtySoFar, Integer.parseInt(fixedQty)))));
                                                p.setName(current.getPromotion());
                                                p.setCoupon(current.getTarget().equals("COUPON"));
                                                tempObj.getItemPromotions().add(p);
                                                tempObj.setDiscount(BigDecimal.valueOf(Math.min(((current.isDiscountInPercentage() ? current.getDiscountAmount() : ((100 * amountSaved) / el.getOriginalPrice().intValue()))), 100)));
                                            } else {
                                                tempObj.setDiscount(BigDecimal.ZERO);
                                            }
                                            Cart.add(tempObj);

                                        }
                                    } else {
                                        LineItemPromotionBean p = null;
                                        p.setPromotionId(current.getPromotionid());
                                        p.setAmountSaved(BigDecimal.valueOf(Math.round(amountSaved * el.getQuantity())));
                                        p.setName(current.getPromotion());
                                        p.setCoupon(current.getTarget().equals("COUPON"));
                                        el.getItemPromotions().add(p);
                                    }
                                }
                            }
                        }
                        break;
                    case "ON_ITEM":
                        Cart = resetCart(Cart);
                        Cart = expandCart(Cart, current, i);
                        for (int j = 0; j < Cart.size(); j++) {
                            OrderLineItemRestBean el = Cart.get(j);
                            //checks if item qualifies, count of discounted items so far
                            if (checkForIncludes(current, el) && generalCheckForPromoType(el, "ON_ITEM")) {

                                int amountSaved = current.isFreeitem() ? (calculateDiscountForFreeItem(el.getProductSku(), current, Cart) ? el.getOriginalPrice().intValue() : 0) : (current.isDiscountInPercentage() ? (current.getDiscountAmount().intValue()) : current.getDiscountAmount().intValue());

                                if (!current.getFixed().isEmpty()) {

                                    if (checkForItemPromotionGeneral(el.getProductSku(), current, Cart, current.getItemPromotionQuantity()) && el.getItemPromotions().isEmpty()) {

                                        LineItemPromotionBean p = null;
                                        p.setPromotionId(current.getPromotionid());
                                        p.setAmountSaved(BigDecimal.valueOf(Math.round(amountSaved * el.getQuantity())));
                                        p.setName(current.getPromotion());
                                        p.setCoupon(current.getTarget().equals("COUPON"));
                                        el.getItemPromotions().add(p);
                                        el.setDiscount(BigDecimal.valueOf(current.isFreeitem() ? (calculateDiscountForFreeItem(el.getProductSku(), current, Cart) ? 100 : 0) : (current.isDiscountInPercentage() ? amountSaved : (current.getDiscountAmount() * 100) / el.getOriginalPrice().intValue())));
                                    }

                                } else {

                                    if (checkForItemPromotionGeneral(el.getProductSku(), current, Cart, current.getItemPromotionQuantity()) && el.getItemPromotions().isEmpty()) {

                                        LineItemPromotionBean p = null;
                                        p.setPromotionId(current.getPromotionid());
                                        p.setAmountSaved(BigDecimal.valueOf(Math.round(amountSaved * el.getQuantity())))
                                        ;
                                        p.setName(current.getPromotion());
                                        p.setCoupon(current.getTarget().equals("COUPON"));

                                        el.getItemPromotions().add(p);
                                        el.setDiscount(BigDecimal.valueOf(current.isFreeitem() ? (calculateDiscountInMinMaxCase(el.getProductSku(), current, Cart) ? 100 : 0) : (current.isDiscountInPercentage() ? amountSaved : (current.getDiscountAmount() * 100) / el.getOriginalPrice().longValue())));

                                    }
                                }

                            }
                        }

                        if (i == Cart.size() - 1) {
                            Cart = shrinkCart(Cart, current.isFreeitem());
                        }
                        break;

                    case "FIXED_PRICE":
                        int pfa = current.getPayFixedAmountReward();
                        Cart = expandCart(Cart, current, i);
                        for (int j = 0; j < Cart.size(); j++) {
                            OrderLineItemRestBean el = Cart.get(j);
                            if (checkForIncludes(current, el) && checkForPromoType(el)) {

                                int amountSaved = (el.getOriginalPrice().longValue() > current.getDiscountAmount()) ? (el.getOriginalPrice().intValue() - current.getDiscountAmount().intValue()) : 0;
                                if (Integer.parseInt(current.getFixed())!=0) {
                                    if (checkForTheCurrentItemQuantity(Cart, el, current) && el.getItemPromotions().isEmpty()) {

                                        LineItemPromotionBean p = null;
                                        p.setPromotionId(current.getPromotionid());
                                        p.setAmountSaved(BigDecimal.valueOf(Math.round(amountSaved * el.getQuantity())));
                                        p.setName(current.getPromotion());
                                        p.setCoupon(current.getTarget().equals("COUPON"));

                                        el.getItemPromotions().add(p);
                                        el.setDiscount(BigDecimal.valueOf(Math.min((((el.getOriginalPrice().longValue() - Math.min(current.getDiscountAmount(), el.getOriginalPrice().longValue())) / el.getOriginalPrice().longValue()) * 100), 100)));
                                    }

                                } else {

                                    LineItemPromotionBean p = null;
                                    p.setPromotionId(current.getPromotionid());
                                    p.setAmountSaved(BigDecimal.valueOf(Math.round(amountSaved * el.getQuantity())));
                                    p.setName(current.getPromotion());
                                    p.setCoupon(current.getTarget().equals("COUPON"));

                                    el.getItemPromotions().add(p);
                                    el.setDiscount(BigDecimal.valueOf(Math.min((((el.getOriginalPrice().longValue() - Math.min(current.getDiscountAmount(), el.getOriginalPrice().longValue())) / el.getOriginalPrice().longValue()) * 100), 100)));

                                }
                            }

                            if (i == Cart.size() - 1) {
                                Cart = shrinkCart(Cart, current.isFreeitem());
                            }
                        }
                        break;

                }

            }

        }
    }

    private boolean checkForTheCurrentItemQuantity(List<OrderLineItemRestBean> cart,OrderLineItemRestBean item,promotions p){
        if((includeItemObj.get(item.getProductSku()) > 0) && (totalItemDoneSoFar < tempCartItems2) && tempCartItems2 >= Integer.parseInt(p.getFixed() )&& !item.getItemPromotions().isEmpty()){
            totalItemDoneSoFar += item.getQuantity();
            includeItemObj.put(item.getProductSku(),includeItemObj.get(item.getProductSku())-item.getQuantity());
            return true;
        } else {
            return false;
        }
    }
    // shrink cart with promoted and non promoted items
    private List<OrderLineItemRestBean> shrinkCart(List<OrderLineItemRestBean> cart,boolean freeItem) {

        Map<String,Boolean> itemMap = new HashMap<>();
        List<OrderLineItemRestBean> newCart=new ArrayList<>();
        for(int i=0;i<cart.size();i++){
            OrderLineItemRestBean item=cart.get(i);
            OrderLineItemRestBean newItem = item;
            //checks if same item is in newCart with the same promotion
            if(!newItem.getItemPromotions().isEmpty() && itemMap.get(newItem.getProductSku()+newItem.getItemPromotions().get(0).getPromotionId()) && !freeItem){
                int index2 = 0;
                        for(int j=0;j<newCart.size();j++) {
                            OrderLineItemRestBean o=newCart.get(j);
                            if((o.getProductSku() == newItem.getProductSku() && (o.getItemPromotions().get(0).getPromotionId() ==o.getItemPromotions().get(0).getPromotionId()))){
                               index2=j;
                               break;
                            }
                        }
                newCart.get(index2).getItemPromotions().get(0).setAmountSaved(newCart.get(index2).getItemPromotions().get(0).getAmountSaved().add(newItem.getItemPromotions().get(0).getAmountSaved()));
                newCart.get(index2).setQuantity(newCart.get(index2).getQuantity()+newItem.getQuantity()) ;
            } else if(!newItem.getItemPromotions().isEmpty()){
                itemMap.put(newItem.getProductSku()+newItem.getItemPromotions().get(0).getPromotionId(),true);
                newCart.add(newItem);
            } else {
                if(itemMap.get(newItem.getProductSku())){
                    int index3 = 0;
                    for(int j=0;j<newCart.size();j++) {
                        OrderLineItemRestBean o=newCart.get(j);
                        if(o.getProductSku() == newItem.getProductSku()){
                            index3=j;
                            break;
                        }
                    }

                    newCart.get(index3).setQuantity(newCart.get(index3).getQuantity()+newItem.getQuantity());
                } else {
                    itemMap.put(newItem.getProductSku(),true);
                    newCart.add(newItem);
                }
            }
        }

        return newCart;
     }

    int totalItemDoneSoFar = 0;
    int tempCartItems2 = 0;
    HashMap<String,Integer> includeItemObj = new HashMap<>();
   private List<OrderLineItemRestBean> expandCart(List<OrderLineItemRestBean> cart, promotions p, int index){

       List<OrderLineItemRestBean> newCart =new ArrayList<>();

       // creating new cart with line items = total quantity
       for(int j=0;j<cart.size();j++){
           OrderLineItemRestBean el=cart.get(j);
           for(int i = 0; i < el.getQuantity(); i++){
              OrderLineItemRestBean newObj = el;
               newObj.setQuantity(1);
               newCart.add(newObj);
           }
       }

       //calculate total qualified unpromoted items
       // creates item:quantity map
       for(int i=0;i<newCart.size();i++){
     OrderLineItemRestBean el=newCart.get(i);
           tempCartItems2 += checkForIncludes(p,el) && el.getItemPromotions().isEmpty() ? el.getQuantity() : 0;
           includeItemObj.put(el.getProductSku(),(includeItemObj.containsKey(el.getProductSku())?includeItemObj.get(el.getProductSku()): 0) + el.getQuantity());
       }


       String fixedQty = p.getFixed();

       if(Boolean.getBoolean(fixedQty) && (tempCartItems2 % Integer.parseInt(fixedQty) != 0)){
           tempCartItems2 = tempCartItems2/Integer.parseInt(fixedQty)*Integer.parseInt(fixedQty);
       }
       return newCart;

   }
    private boolean cumulativeCheck(String sku, promotions
            p, List<OrderLineItemRestBean> cart) {
        if (p.isCumulative()) return true;

        int count = 0;
        for (int j = 0; j < cart.size(); j++) {
            OrderLineItemRestBean el = cart.get(j);
            count += (el.getProductSku().equals(sku)) ? el.getQuantity() : 0;
        }

        boolean condition1 = Boolean.parseBoolean(p.getMin()) ? (Integer.parseInt(p.getMin()) <= count) : true;
        boolean condition2 = Boolean.parseBoolean(p.getMax()) ? (Integer.parseInt(p.getMax()) >= count) : true;
        boolean condition3 = Boolean.parseBoolean(p.getFixed()) ? (Integer.parseInt(p.getFixed()) == count) : true;
        return condition1 && condition2 && condition3;
    }

    private boolean searchForTheAppliedPromotion(String promotion, List<LineItemPromotionBean> itemPromotions) {

        for (int i = 0; i < itemPromotions.size(); i++) {
            if (itemPromotions.get(i).getName().equals(promotion))
                return true;
        }
        return false;
    }

    private int searchForIteminCart(List<OrderLineItemRestBean> cart, String
            sku, promotions current) {
        int count = 0;
        for (int i = 0; i < cart.size(); i++) {
            OrderLineItemRestBean el = cart.get(i);
            if (el.getProductSku().equals(sku) && !el.getItemPromotions().isEmpty() && searchForTheAppliedPromotion(current.getPromotion(), el.getItemPromotions()))
                count += el.getQuantity();
        }
        return count;
    }
    private int getcartTotal(List<OrderLineItemRestBean> Cart, promotions p) {
        int cartTotal = 0;
        for (int i = 0; i < Cart.size(); i++) {
            OrderLineItemRestBean currentItem = Cart.get(i);
            int totalDiscount = 0;
            for (int j = 0; j < currentItem.getItemPromotions().size(); j++) {
                totalDiscount += currentItem.getItemPromotions().get(j).getAmountSaved().intValue();
            }
            cartTotal += (currentItem.getUnitPrice().intValue() * currentItem.getQuantity()) - totalDiscount;
        }
        return cartTotal;
    }

    boolean recheckCartTotal(List<OrderLineItemRestBean> Cart, promotions p) {
        int cartTotal = 0;
        for (int i = 0; i < Cart.size(); i++) {
            OrderLineItemRestBean currentItem = Cart.get(i);
            int totalDiscount = 0;
            for (int j = 0; j < currentItem.getItemPromotions().size(); j++) {
                totalDiscount += currentItem.getItemPromotions().get(j).getAmountSaved().intValue();
            }
            cartTotal += (currentItem.getUnitPrice().intValue() * currentItem.getQuantity()) - totalDiscount;
        }
        boolean condition1 = Boolean.parseBoolean(p.getMin()) ? Integer.parseInt(p.getMin()) <= cartTotal : true;

        boolean condition2 = Boolean.parseBoolean(p.getMax()) ? Integer.parseInt(p.getMax()) >= cartTotal : true;

        boolean condition3 = Boolean.parseBoolean(p.getFixed()) ? Integer.parseInt(p.getFixed()) == cartTotal : true;


        return condition1 && condition2 && condition3;
    }

    private List<OrderLineItemRestBean> removeAllPromotion
            (List<OrderLineItemRestBean> cart) {
        List<OrderLineItemRestBean> item = null;
        //I will pass the original cart model here
        for (int i = 0; i < item.size(); i++) {
            OrderLineItemRestBean currentItem = item.get(i);
            if (!currentItem.getItemPromotions().isEmpty()) {
                currentItem.setDiscount(BigDecimal.ZERO);
                currentItem.setUnitPrice(currentItem.getOriginalPrice());
            }
        }
        return item;
    }

    private List<OrderLineItemRestBean> resetCart(List<OrderLineItemRestBean> cart) {
        List<OrderLineItemRestBean> item = null;
        //I will pass the original cart model here
        List<OrderLineItemRestBean> newCart = null;
        HashMap<String, Integer> cartmap = null;
        for (int j = 0; j < item.size(); j++) {
            //I got the current item here
            OrderLineItemRestBean currentItem = item.get(j);
            if (cartmap.containsKey(currentItem.getSkuid())) {
                //Then increase its Quantity
                int Index = newCart.indexOf(currentItem);
                int newItem = newCart.get(Index).getQuantity();
                newCart.get(Index).setQuantity(newItem + currentItem.getQuantity());
            } else {
                //This item was not present earlier
                cartmap.put(currentItem.getSkuid(), currentItem.getQuantity());
                newCart.add(currentItem);
            }
        }
        return item;
    }

    private void apply_promotion_service() {
        int getcarttotal;
        if (!ON_PURCHASE_VALUE.isEmpty()) {
            for (int i = 0; i < ON_PURCHASE_VALUE.size(); i++) {
                int tempCartTotal = 0;
                //Iterating in cart now
                promotions p = ON_PURCHASE_VALUE.get(i);
                List<OrderLineItemRestBean> item = null;
                //I will pass the original cart model here
                for (int j = 0; j < item.size(); j++) {

                    tempCartTotal += checkForIncludes(p, item.get(j)) ? item.get(j).getOriginalPrice().intValue() * item.get(j).getQuantity() : 0;
                    //      item.get(j).getItemPromotions()=[];
                    //        item.get(j).setDiscount(0);

                    boolean condition1 = Boolean.parseBoolean(p.getMin()) ? Integer.parseInt(p.getMin()) <= tempCartTotal : true;

                    boolean condition2 = Boolean.parseBoolean(p.getMax()) ? Integer.parseInt(p.getMax()) >= tempCartTotal : true;

                    boolean condition3 = Boolean.parseBoolean(p.getFixed()) ? Integer.parseInt(p.getFixed()) == tempCartTotal : true;
                    if (condition1 && condition2 && condition3) {
                        PURCHASE_VALUE_PROMOTIONS.add(p);
                    }
                }

            }

        }

    }

    private void apply_promotion_service2() {
        //check if cumulative flag is true (p.promotionRule.cumulative);

        if (!ON_PURCHASE_ITEM.isEmpty()) {
            for (int i = 0; i < ON_PURCHASE_ITEM.size(); i++) {
                int tempCartItems = 0;
                //Iterating in cart now
                promotions p = ON_PURCHASE_ITEM.get(i);
                if (p.isCumulative()) {
                    int tempcartitems = 0;

                    List<OrderLineItemRestBean> item = null;
                    //I will pass the original cart model here
                    for (int j = 0; j < item.size(); j++) {

                        tempCartItems += checkForIncludes(p, item.get(j)) ? item.get(j).getOriginalPrice().intValue() * item.get(j).getQuantity() : 0;
                        //      item.get(j).getItemPromotions()=[];
                        //        item.get(j).setDiscount(0);

                        boolean condition1 = Boolean.parseBoolean(p.getMin()) ? Integer.parseInt(p.getMin()) <= tempCartItems : true;

                        boolean condition2 = Boolean.parseBoolean(p.getMax()) ? Integer.parseInt(p.getMax()) >= tempCartItems : true;

                        boolean condition3 = Boolean.parseBoolean(p.getFixed()) ? Integer.parseInt(p.getFixed()) == tempCartItems : true;
                        if (condition1 && condition2 && condition3) {
                            PURCHASE_ITEM_PROMOTIONS.add(p);
                        }

                    }
                } else {
                    //If cumulative flag is false
                    Map<String, Integer> individualItemCount = null;

                    //I will pass the original cart model here
                    List<OrderLineItemRestBean> item = null;
                    //I will pass the original cart model here
                    for (int j = 0; j < item.size(); j++) {
                        individualItemCount.put(item.get(j).getHsn(), checkForIncludes(p, item.get(j)) ? item.get(j).getOriginalPrice().intValue() * item.get(j).getQuantity() : 0);
                    }
                    for (int j = 0; j < individualItemCount.size(); j++) {
                        boolean condition1 = Boolean.parseBoolean(p.getMin()) ? Integer.parseInt(p.getMin()) <= individualItemCount.get(item.get(j).getHsn()) : true;

                        boolean condition2 = Boolean.parseBoolean(p.getMax()) ? Integer.parseInt(p.getMax()) >= individualItemCount.get(item.get(j).getHsn()) : true;

                        boolean condition3 = Boolean.parseBoolean(p.getFixed()) ? Integer.parseInt(p.getFixed()) == individualItemCount.get(item.get(j).getHsn()) : true;
                        if (condition1 && condition2 && condition3) {
                            PURCHASE_ITEM_PROMOTIONS.add(p);
                        }
                    }
                }
            }
        }
    }

    private boolean checkForIncludes(promotions arr, OrderLineItemRestBean el) {

        boolean inludeflag = ((arr.skuList.isEmpty() || getIndexByProperty(arr.skuList, el.getSkuid(), el.getSkuname()) != -1)
                && (arr.brandList.isEmpty() || getIndexByProperty(arr.brandList, el.getBrandid(), el.getBrandname()) != -1)
                && (arr.categoryList.isEmpty() || getIndexByProperty(arr.categoryList, el.getCategoryid(), el.getCategoryname()) != -1)
                && (arr.tagList.isEmpty() || getIndexByProperty(arr.tagList, el.getTagid(), el.getTagname()) != -1));

        boolean excludeflag = ((arr.eskuList.isEmpty() || getIndexByProperty(arr.eskuList, el.getSkuid(), el.getSkuname()) != -1)
                && (arr.ebrandList.isEmpty() || getIndexByProperty(arr.ebrandList, el.getBrandid(), el.getBrandname()) != -1)
                && (arr.ecategoryList.isEmpty() || getIndexByProperty(arr.ecategoryList, el.getCategoryid(), el.getCategoryname()) != -1)
                && (arr.etagList.isEmpty() || getIndexByProperty(arr.etagList, el.getTagid(), el.getTagname()) != -1));

        return inludeflag && excludeflag;
    }

    private int getIndexByProperty(List<ListModel> current, String id, String name) {
        for (int i = 0; i < current.size(); i++) {
            ListModel currentobj = current.get(i);
            if (currentobj.getId().equals(id) && currentobj.getName().equals(name)) {
                return i;
            }
        }
        return -1;
    }


    private boolean checkForPromoType(OrderLineItemRestBean item){
        List<LineItemPromotionBean> promotions =new ArrayList<>();
        for(int i=0;i<item.getItemPromotions().size();i++){
            if(item.getItemPromotions().get(i).getPromotype().equals("FIXED_PRICE")){
                promotions.add(item.getItemPromotions().get(i));
            }
        }
        return promotions.isEmpty();
    }

    private boolean generalCheckForPromoType(OrderLineItemRestBean item,String check){
        List<LineItemPromotionBean> promotions =new ArrayList<>();
        for(int i=0;i<item.getItemPromotions().size();i++){
            if(item.getItemPromotions().get(i).getPromotype().equals(check)){
                promotions.add(item.getItemPromotions().get(i));
            }
        }

        return promotions.isEmpty();
    }

    //calculate discount for free items
    private boolean calculateDiscountForFreeItem( String sku,promotions p,List<OrderLineItemRestBean> cart){

       int totalSku = 0;
        int promotedQty = 0;
        int freedQty = p.getItemPromotionQuantity();
        int fixedQty = Integer.parseInt(p.getFixed());
        boolean cumulativeFlag = p.isCumulative();

        for(int i=0;i<cart.size();i++){
        OrderLineItemRestBean el=cart.get(i);
            if(cumulativeFlag){
                totalSku++;
                if(el.getDiscount().intValue() > 0){
                    promotedQty++;
                }
            } else {
                if(el.getProductSku().equals(sku)){
                    totalSku++;
                    if(el.getDiscount().intValue()> 0){
                        promotedQty++;
                    }
                }
            }
        }

        int totalPromotableQty = (totalSku/fixedQty) * freedQty;
        return (totalSku >= fixedQty) && (promotedQty < totalPromotableQty);
    }

    private boolean calculateDiscountInMinMaxCase (String sku,promotions p,List<OrderLineItemRestBean> cart){
       int promotedQty = 0;
        int freedQty = p.getItemPromotionQuantity();
        boolean cumulativeFlag = p.isCumulative();

        for(int i=0;i<cart.size();i++){
            OrderLineItemRestBean el=cart.get(i);
            if(cumulativeFlag){
                if(el.getDiscount().intValue()> 0){
                    promotedQty++;
                }
            } else {
                if(el.getProductSku().equals(sku) ){
                    if(el.getDiscount().intValue() > 0){
                        promotedQty++;
                    }
                }
            }
        }

        return (promotedQty < freedQty);

    };

    private boolean checkForItemPromotionGeneral(String sku,promotions p,List<OrderLineItemRestBean> cart,int discountedQty){
        int totalSku = 0;
        int promotedQty = 0;
        int fixedQty = Integer.parseInt(p.getFixed());
        int minQty = Integer.parseInt(p.getMin());
        int maxQty = Integer.parseInt(p.getMax());
        boolean cumulativeFlag = p.isCumulative();

        for(int i=0;i<cart.size();i++){
            OrderLineItemRestBean el=cart.get(i);
            if(cumulativeFlag){
                totalSku++;
                if(el.getItemPromotions().size() > 0){
                    promotedQty++;
                }
            } else {
                if(el.getProductSku().equals(sku)){
                    totalSku++;
                    if(el.getItemPromotions().size() > 0){
                        promotedQty++;
                    }
                }
            }
        }

        int totalPromotableQty =  fixedQty!=0 ?  ((totalSku/fixedQty) * fixedQty) : ((totalSku >= minQty && totalSku <= maxQty) ? discountedQty : 0);

        return promotedQty < totalPromotableQty;

    }




